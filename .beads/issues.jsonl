{"id":"claude_code_bridge-s7t","title":"Simplify CCB to Claude+Codex Only","description":"Simplify Claude Code Bridge from a 5-provider, multi-platform system to a minimal 2-provider (Claude + Codex) solution for **macOS + Linux only** (no Windows, no WSL).\n\n## Goals\n- Providers: keep **codex** + **claude** only; remove **gemini/opencode/droid**\n- Platform: remove Windows/WSL compatibility and Windows-specific artifacts\n- UX: replace `pend` with **reply-via-ask**; `ask` becomes **pure async** (submit-only)\n- Remove MCP delegation integration (`mcp/ccb-delegation`, `ccb droid setup-delegation`)\n- Keep both tmux + WezTerm backends\n\n## Notes\n- Keep repo green per-layer: `python -m compileall -q lib bin ccb` + targeted `pytest`.\n- No “read results from logs” UX (no `pend`, no completion hook prompting `pend`).\n\n## Estimated reduction\n~4,500+ lines of code, 20+ files deleted (likely more once docs/tests/installers are pruned).\n","status":"open","priority":1,"issue_type":"epic","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:38:16.250679-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T13:21:39.237439-08:00","labels":["simplification"]}
{"id":"claude_code_bridge-s7t.1","title":"Delete Gemini provider files","description":"Remove all Gemini-related code from the codebase.\n\n## Files to DELETE\n- bin/gask, bin/gaskd, bin/gpend, bin/gping\n- lib/gaskd_daemon.py, lib/gaskd_protocol.py, lib/gaskd_session.py\n- lib/gemini_comm.py\n- lib/askd/adapters/gemini.py\n\n## Verification\n- pytest passes\n- No import errors","status":"closed","priority":1,"issue_type":"task","assignee":"stefanc-ai2","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:38:48.333354-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T14:39:10.449044-08:00","closed_at":"2026-01-30T14:39:10.449044-08:00","close_reason":"Deleted Gemini provider files","labels":["provider-removal","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.1","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:38:48.333922-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.1","depends_on_id":"claude_code_bridge-s7t.4","type":"blocks","created_at":"2026-01-30T13:25:55.427879-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.10","title":"Delete pend + completion hook","description":"Remove all `pend` UX and the completion hook machinery (since results are delivered via reply-via-ask).\n\n## Files to DELETE\n- `bin/pend`\n- `bin/cpend`\n- `bin/lpend`\n- `claude_skills/pend/` (entire directory)\n- `codex_skills/pend/` (entire directory)\n- `bin/ccb-completion-hook`\n- `lib/completion_hook.py`\n\n## Follow-ups\n- Remove imports/usages of completion hook from provider adapters.\n- Update any docs/tests that reference `pend` or hook output.\n\n## Verification\n- `pend codex` is gone (or replaced with a stub that explains migration)\n- No remaining references to `pend` in skills/docs (outside historical changelog files)\n","status":"open","priority":1,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:40:29.777733-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T13:22:46.998636-08:00","labels":["async-ask","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.10","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:40:29.778315-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.10","depends_on_id":"claude_code_bridge-s7t.9","type":"blocks","created_at":"2026-01-30T12:40:34.204308-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.10","depends_on_id":"claude_code_bridge-s7t.11","type":"blocks","created_at":"2026-01-30T13:26:21.694163-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.11","title":"Update skills for async bidirectional model","description":"Update skills to match the new model:\n- `ask` is always async\n- results arrive via reply-via-ask (`--reply-to`)\n- no `pend`\n- no MCP references\n\n## Files to MODIFY\n- `claude_skills/ask/SKILL.md`\n  - Document async + `--reply-to`\n  - Remove all `pend` references\n  - Remove MCP references\n- `codex_skills/ask/SKILL.md`\n  - When receiving `CCB_REQ_ID`, reply via: `ask claude --reply-to=\u003creq_id\u003e --no-wrap \"...\"`\n- `claude_skills/pair/SKILL.md` (+ references)\n  - Replace “ask + pend” review loop with “ask + reply-via-ask” (collect replies in-pane)\n- `claude_skills/poll/SKILL.md` (+ references)\n  - Same replacement\n\n## Verification\n- Skills no longer mention `pend`\n- Provider instructions clearly explain replying via `ask ... --reply-to=...`\n","status":"open","priority":1,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:40:41.788857-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T13:23:01.086863-08:00","labels":["async-ask","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.11","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:40:41.78939-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.11","depends_on_id":"claude_code_bridge-s7t.8","type":"blocks","created_at":"2026-01-30T12:40:47.562154-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.12","title":"Consolidate session registries (optional)","description":"Merge multiple registry files into a single unified session registry.\n\n## Files to MERGE\n- lib/pane_registry.py (363 lines)\n- lib/laskd_registry.py (659 lines)\n- lib/claude_session_resolver.py (358 lines)\n\nInto: lib/session_registry.py (~400 lines)\n\n## Verification\n- All existing tests pass\n- Session resolution works correctly for both Claude and Codex","status":"open","priority":3,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:40:54.429633-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T12:40:54.429633-08:00","labels":["optional","refactor","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.12","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:40:54.430197-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.12","depends_on_id":"claude_code_bridge-s7t.11","type":"blocks","created_at":"2026-01-30T12:41:00.06643-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.12","depends_on_id":"claude_code_bridge-s7t.6","type":"blocks","created_at":"2026-01-30T12:41:00.250239-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.13","title":"Remove MCP integration","description":"Remove MCP delegation integration entirely (out of scope for the simplified repo).\n\n## Files to DELETE / MODIFY (minimum)\n- Delete: `mcp/` (entire directory)\n- Modify: `ccb`\n  - Remove `ccb droid setup-delegation` and `ccb droid test-delegation`\n  - Remove any setup hints that reference delegation\n- Modify: `install.sh`\n  - Remove droid MCP auto-install blocks (add/remove ccb-delegation)\n- Modify: `README.md` / `README_zh.md`\n  - Remove references to MCP delegation setup\n- Consider deleting or archiving: `plans/droid-delegation-skills-plan.md`\n\n## Verification\n- `rg -n \"ccb-delegation|setup-delegation\" -S` finds nothing (outside historical changelog files)\n","status":"closed","priority":2,"issue_type":"task","assignee":"stefanc-ai2","owner":"stefanc@allenai.org","created_at":"2026-01-30T13:23:31.168789-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T14:55:52.618306-08:00","closed_at":"2026-01-30T14:55:52.618306-08:00","close_reason":"Removed MCP delegation server, installer hooks, and CLI references.","labels":["mcp-removal","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.13","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T13:23:46.052354-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.13","depends_on_id":"claude_code_bridge-s7t.3","type":"blocks","created_at":"2026-01-30T13:26:26.960079-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.14","title":"Update docs/README/CLAUDE.md","description":"Update all user-facing docs to match the simplified scope:\n- Providers: only `codex` + `claude`\n- Platform: macOS/Linux only (no Windows/WSL)\n- UX: no `pend`; reply-via-ask (`--reply-to`)\n- No MCP delegation tooling\n\n## Files to MODIFY (minimum)\n- `README.md`\n- `README_zh.md`\n- `CLAUDE.md`\n- `CHANGELOG.md` (add an Unreleased entry for the breaking changes)\n\n## Verification\n- `rg -n \"\\b(gemini|opencode|droid)\\b\" README.md README_zh.md CLAUDE.md` returns nothing\n- `rg -n \"\\bpend\\b\" README.md README_zh.md CLAUDE.md` returns nothing\n- `rg -n \"ccb-delegation|setup-delegation\" README.md README_zh.md` returns nothing\n","notes":"Add explicit removal of any docs/design language suggesting log-tail monitoring for results; document that results arrive in-pane / reply-via-ask only.","status":"open","priority":2,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T13:23:58.800201-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T13:48:54.170274-08:00","labels":["docs","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.14","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T13:24:07.17897-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.14","depends_on_id":"claude_code_bridge-s7t.4","type":"blocks","created_at":"2026-01-30T13:26:32.220855-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.14","depends_on_id":"claude_code_bridge-s7t.7","type":"blocks","created_at":"2026-01-30T13:26:37.495365-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.14","depends_on_id":"claude_code_bridge-s7t.10","type":"blocks","created_at":"2026-01-30T13:26:42.758132-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.14","depends_on_id":"claude_code_bridge-s7t.13","type":"blocks","created_at":"2026-01-30T13:26:48.040755-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.15","title":"Update/delete tests + system scripts","description":"Update the test suite to match the simplified scope (2 providers, Unix-only, no pend, no MCP).\n\n## Expected changes\n- Delete provider-specific tests for removed providers (Gemini/OpenCode/Droid).\n- Delete or refactor system scripts that exercise removed providers and/or `pend`.\n- Update any tests that enumerate provider lists or assume Windows/WSL.\n\n## Likely targets\n- Provider tests: `test/test_gaskd_session_ensure_pane.py`, `test/test_oaskd_session.py`, droid-related tests\n- System scripts: `test/system_ccb_daemon.sh`, `test/system_pend_isolation.sh`, `test/system_comm_matrix.sh`\n\n## Verification\n- `pytest test/ -v --tb=short` passes on macOS/Linux\n","status":"open","priority":2,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T13:24:18.853718-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T13:24:18.853718-08:00","labels":["simplification","tests"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.15","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T13:24:27.317771-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.15","depends_on_id":"claude_code_bridge-s7t.1","type":"blocks","created_at":"2026-01-30T13:26:53.314273-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.15","depends_on_id":"claude_code_bridge-s7t.2","type":"blocks","created_at":"2026-01-30T13:26:58.613484-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.15","depends_on_id":"claude_code_bridge-s7t.3","type":"blocks","created_at":"2026-01-30T13:27:03.863378-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.15","depends_on_id":"claude_code_bridge-s7t.6","type":"blocks","created_at":"2026-01-30T13:27:09.130649-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.15","depends_on_id":"claude_code_bridge-s7t.10","type":"blocks","created_at":"2026-01-30T13:27:14.393033-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.16","title":"Simplify install.sh (Unix-only)","description":"Simplify `install.sh` for Unix-only and 2-provider scope.\n\n## Goals\n- Only install/link commands that remain (`ccb`, `ask`, `ping`, `askd`, and any codex/claude shims you keep).\n- Remove WSL/Windows prompts and checks.\n- Remove MCP delegation install/remove logic.\n- Stop linking `pend` and completion-hook scripts.\n\n## Files to MODIFY\n- `install.sh`\n\n## Verification\n- Fresh install produces a minimal working toolset for codex+claude.\n- `rg -n \"mcp|droid mcp|setup-delegation\" install.sh` returns nothing.\n","status":"open","priority":2,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T13:24:39.192637-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T13:24:39.192637-08:00","labels":["install","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.16","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T13:24:47.4078-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.16","depends_on_id":"claude_code_bridge-s7t.1","type":"blocks","created_at":"2026-01-30T13:27:19.68978-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.16","depends_on_id":"claude_code_bridge-s7t.2","type":"blocks","created_at":"2026-01-30T13:27:24.997973-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.16","depends_on_id":"claude_code_bridge-s7t.3","type":"blocks","created_at":"2026-01-30T13:27:30.292864-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.16","depends_on_id":"claude_code_bridge-s7t.7","type":"blocks","created_at":"2026-01-30T13:27:35.591349-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.16","depends_on_id":"claude_code_bridge-s7t.10","type":"blocks","created_at":"2026-01-30T13:27:40.915431-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.16","depends_on_id":"claude_code_bridge-s7t.13","type":"blocks","created_at":"2026-01-30T13:27:46.217563-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.2","title":"Delete OpenCode provider files","description":"Remove all OpenCode-related code from the codebase.\n\n## Files to DELETE\n- bin/oask, bin/oaskd, bin/opend, bin/oping\n- lib/oaskd_daemon.py, lib/oaskd_protocol.py, lib/oaskd_session.py\n- lib/opencode_comm.py\n- lib/askd/adapters/opencode.py\n\n## Verification\n- pytest passes\n- No import errors","status":"closed","priority":1,"issue_type":"task","assignee":"stefanc-ai2","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:38:53.924659-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T14:42:41.485955-08:00","closed_at":"2026-01-30T14:42:41.485955-08:00","close_reason":"Deleted OpenCode provider files","labels":["provider-removal","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.2","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:38:53.925226-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.2","depends_on_id":"claude_code_bridge-s7t.4","type":"blocks","created_at":"2026-01-30T13:26:00.672329-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.3","title":"Delete Droid provider files","description":"Remove all Droid-related code from the codebase.\n\n## Files to DELETE\n- bin/dask, bin/daskd, bin/dpend, bin/dping\n- lib/daskd_daemon.py, lib/daskd_protocol.py, lib/daskd_session.py\n- lib/droid_comm.py\n- lib/askd/adapters/droid.py\n- droid_skills/ (entire directory)\n\n## Verification\n- pytest passes\n- No import errors","status":"closed","priority":1,"issue_type":"task","assignee":"stefanc-ai2","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:38:58.896979-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T14:45:00.54157-08:00","closed_at":"2026-01-30T14:45:00.54157-08:00","close_reason":"Deleted Droid provider files","labels":["provider-removal","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.3","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:38:58.897665-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.3","depends_on_id":"claude_code_bridge-s7t.4","type":"blocks","created_at":"2026-01-30T13:26:05.911778-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.4","title":"Restrict providers to codex+claude","description":"Restrict all CLI surfaces and routing tables to only support `codex` and `claude`.\n\nGoal: once this lands, *nothing* should advertise or accept `gemini`, `opencode`, or `droid`.\n\n## Files to MODIFY (minimum)\n- `lib/providers.py`\n  - Remove `GASK_CLIENT_SPEC`, `OASK_CLIENT_SPEC`, `DASK_CLIENT_SPEC`\n- `lib/ccb_start_config.py`\n  - `DEFAULT_PROVIDERS = [\"codex\", \"claude\"]`\n  - Restrict allowed providers set to `{ \"codex\", \"claude\" }`\n- `bin/ask`\n  - Provider list + help output\n- `bin/askd`\n  - Only register Codex + Claude adapters\n- `bin/ping`\n  - Only support `codex` + `claude`\n- `bin/ccb-mounted`\n  - Only support `codex` + `claude`\n- `ccb`\n  - Remove provider-specific codepaths for gemini/opencode/droid\n  - Remove droid delegation command wiring (setup/test delegation)\n- `lib/askd/adapters/base.py`\n  - Update docstrings/comments to remove references to removed providers\n\n## Verification\n- `ask gemini \"hi\"` prints unknown provider\n- `ping opencode` prints unknown provider\n- `ccb codex,claude` starts successfully\n","status":"closed","priority":1,"issue_type":"task","assignee":"stefanc-ai2","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:39:07.464458-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T14:32:10.777515-08:00","closed_at":"2026-01-30T14:32:10.777515-08:00","close_reason":"Implemented: restrict providers to codex+claude (CLI + launcher)","labels":["provider-removal","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.4","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:39:07.465017-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.5","title":"Remove Windows/WSL compatibility from lib/","description":"Remove Windows and WSL-specific code from library modules.\n\n## Files to MODIFY\n\n**lib/terminal.py**\n- Remove _extract_wsl_path_from_unc_like_path()\n- Simplify _default_shell() to always return (\"bash\", \"-c\")\n\n**lib/compat.py** - Simplify to ~20 lines (no-op on Unix)\n\n**lib/ccb_config.py** - Remove WSL detection\n\n**lib/project_id.py** - Remove Windows drive path normalization\n\n## Verification\n- pytest passes on macOS/Linux","status":"open","priority":2,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:39:41.336469-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T12:39:41.336469-08:00","labels":["platform","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.5","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:39:41.3371-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.6","title":"Remove Windows/WSL from ccb and bin scripts","description":"Remove Windows-specific code from main scripts.\n\n## Files to MODIFY\n- ccb - Remove Windows-specific subprocess handling, PowerShell paths\n- bin/ask - Remove Windows process creation flags\n\n## Verification\n- ccb codex,claude works on macOS/Linux\n- ask codex \"test\" works on macOS/Linux","status":"open","priority":2,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:39:47.525845-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T12:39:47.525845-08:00","labels":["platform","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.6","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:39:47.526393-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.6","depends_on_id":"claude_code_bridge-s7t.5","type":"blocks","created_at":"2026-01-30T12:39:51.662639-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.7","title":"Delete Windows install scripts","description":"Remove Windows installation support and Windows-only artifacts.\n\n## Files to DELETE\n- `install.ps1`\n- `install.cmd`\n- `bin/ccb-ping.cmd`\n- `**/SKILL.md.powershell` (all PowerShell skill variants)\n\n## Verification\n- `./install.sh install` still works on macOS/Linux\n- No references to Windows/PowerShell in the remaining install path (outside archived changelogs)\n","status":"closed","priority":2,"issue_type":"task","assignee":"stefanc-ai2","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:39:57.198843-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T15:09:39.175683-08:00","closed_at":"2026-01-30T15:09:39.175683-08:00","close_reason":"Deleted Windows-only install scripts/artifacts (install.ps1/install.cmd, cmd wrappers, PowerShell SKILL variants) and removed runtime references.","labels":["platform","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.7","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:39:57.19942-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.8","title":"Add --reply-to flag and response markers to protocol","description":"Add support for reply-via-ask correlation with a `--reply-to` flag and reply markers.\n\n## Protocol\nRequest (existing wrap style):\n```\nCCB_REQ_ID: \u003creq_id\u003e\n\n\u003cmessage\u003e\n\nCCB_DONE: \u003creq_id\u003e\n```\n\nResult/Reply (sent by callee):\n- Callee sends a result back via `ask \u003ccaller\u003e --reply-to=\u003creq_id\u003e ...`\n- `--reply-to` should default to a **result/notification** payload (i.e., do not wrap with “end with CCB_DONE” instructions).\n\nExample payload:\n```\nCCB_REPLY: \u003coriginal_req_id\u003e\nCCB_FROM: \u003csender_provider\u003e\n[CCB_RESULT] No reply required.\n\n\u003canswer\u003e\n```\n\n## Files to MODIFY\n- `bin/ask`\n  - Add `--reply-to=\u003creq_id\u003e`\n  - When set, inject `CCB_REPLY:` and `CCB_FROM:` lines\n  - Make `--reply-to` imply `--no-wrap` (or equivalent) to avoid triggering a reply loop\n- `lib/ccb_protocol.py`\n  - Add marker constants: `REPLY_PREFIX = \"CCB_REPLY:\"`, `FROM_PREFIX = \"CCB_FROM:\"`\n\n## Verification\n- `ask claude --reply-to=\u003cid\u003e --no-wrap \"...\"` delivers a marked result message\n","status":"open","priority":1,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:40:06.536844-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T13:45:25.229258-08:00","labels":["async-ask","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.8","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:40:06.537389-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-s7t.9","title":"Simplify daemon to pure async (remove polling)","description":"Make `ask` and the unified `askd` daemon **submit-only** (pure async) and remove any log-monitoring-based result retrieval.\n\n## Key principle\nCCB must not tail/monitor provider logs to fetch “latest result”. Results are delivered only via the interactive panes (human-visible) and the reply-via-ask pattern (when implemented).\n\n## Intended behavior\n- `ask \u003cprovider\u003e \u003cmessage\u003e` enqueues the send and returns immediately.\n- `ask` prints the generated `req_id` (for correlation / `--reply-to`).\n- `askd` does not read provider logs, does not wait for `CCB_DONE`, and does not attempt to reconstruct replies.\n\n## Files to MODIFY (minimum)\n- `bin/ask`\n  - Remove `--foreground` / `--background` and any blocking wait paths\n  - Always submit to `askd`, print req_id, exit\n- `lib/askd/daemon.py`\n  - Return immediately after task enqueue (do not wait on `done_event`)\n- `lib/askd/adapters/codex.py`\n  - Remove `CodexLogReader` usage and done-marker waiting loops; just `send_text()`\n- `lib/askd/adapters/claude.py`\n  - Remove `ClaudeLogReader` usage and done-marker waiting loops; just `send_text()`\n\n## Verification\n- `ask codex \"hi\"` returns immediately with a req_id\n- `askd` still provides per-session serialization (no interleaving sends)\n- No log-tail style logic in the ask/askd path:\n  - `rg -n \"CodexLogReader|ClaudeLogReader|wait_for_event\\(|wait_for_events\\(|wait_for_message\\(\" bin/ask lib/askd` returns nothing\n","status":"open","priority":1,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T12:40:20.127462-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T13:48:45.455327-08:00","labels":["async-ask","simplification"],"dependencies":[{"issue_id":"claude_code_bridge-s7t.9","depends_on_id":"claude_code_bridge-s7t","type":"parent-child","created_at":"2026-01-30T12:40:20.128061-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-s7t.9","depends_on_id":"claude_code_bridge-s7t.8","type":"blocks","created_at":"2026-01-30T12:40:24.245544-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-zjc","title":"Robustness: eliminate hangs, stale state, and lock races","description":"Epic for CCB robustness improvements.\n\n## Scope\n1. RPC timeouts + deadline propagation (Critical)\n2. Atomic state writes + validation helper (Critical)\n3. Lock robustness - TOCTOU, FD leaks (Critical)\n4. Stale state detection - TTL, pid checks (High)\n5. Replace bare exception handlers (High)\n\n## Success Criteria\n- No socket operations can hang indefinitely\n- State file writes are atomic and validated\n- Lock acquisition is race-free\n- Stale sessions are detected and cleaned up\n- Exceptions are typed and debuggable","status":"open","priority":1,"issue_type":"epic","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:00:55.030591-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:00:55.030591-08:00","labels":["robustness"]}
{"id":"claude_code_bridge-zjc.1","title":"RPC: add per-recv timeouts + request deadlines","description":"Add hard timeouts to all RPC/socket I/O to prevent indefinite hangs.\n\n## Files\n- lib/askd_client.py\n- lib/askd_rpc.py\n- bin/ask\n\n## Implementation\n- Add socket.settimeout() for all recv operations\n- Implement deadline propagation (pass timeout_s down call stack)\n- Wrap decode loops with deadline checks\n- Surface single timeout error type (CCBTimeoutError)\n\n## Acceptance Criteria\n- [ ] Every connect/send/recv has bounded timeout\n- [ ] Global request deadline prevents partial-read hangs\n- [ ] Consistent timeout error type surfaced to callers\n- [ ] Tests for timeout scenarios","status":"closed","priority":1,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:01:14.590972-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:12:48.317422-08:00","closed_at":"2026-01-30T02:12:48.317424-08:00","labels":["quick-win","robustness","rpc"],"dependencies":[{"issue_id":"claude_code_bridge-zjc.1","depends_on_id":"claude_code_bridge-zjc","type":"parent-child","created_at":"2026-01-30T02:01:14.59182-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-zjc.2","title":"State: atomic writes + JSON validation helper","description":"Make session/state writes atomic and add validation.\n\n## Files\n- lib/session_utils.py\n- lib/pane_registry.py\n- daemon state writers\n\n## Implementation\n- Standardize: temp file → fsync → os.replace → chmod(0o600)\n- Create read_json_state(path, schema=None) helper\n- Add minimal schema validation for required keys/types\n- Replace scattered json.loads() with validated reads\n\n## Acceptance Criteria\n- [ ] All state writes use atomic pattern\n- [ ] Validation helper with schema support\n- [ ] File permissions hardened (0o600)\n- [ ] Tests for concurrent write scenarios","status":"open","priority":1,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:01:14.779267-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:01:14.779267-08:00","labels":["quick-win","robustness","state"],"dependencies":[{"issue_id":"claude_code_bridge-zjc.2","depends_on_id":"claude_code_bridge-zjc","type":"parent-child","created_at":"2026-01-30T02:01:14.779771-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-zjc.3","title":"Locks: fix TOCTOU + FD leaks; add contention tests","description":"Eliminate TOCTOU races and FD leaks in lock implementation.\n\n## Files\n- lib/process_lock.py\n\n## Implementation\n- Use single open FD with O_CLOEXEC, always closed on retry/failure\n- Rely on OS primitives (exclusive create / flock) not check-then-create\n- Add contention tests: multiple processes competing for same lock\n\n## Acceptance Criteria\n- [ ] No TOCTOU window in lock acquisition\n- [ ] No FD leaks on retry/failure paths\n- [ ] Tests: one winner, no leaked FDs, bounded wait, cleanup on crash\n- [ ] Works correctly on Windows and Unix","status":"open","priority":1,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:01:14.976308-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:01:14.976308-08:00","labels":["locks","refactor","robustness"],"dependencies":[{"issue_id":"claude_code_bridge-zjc.3","depends_on_id":"claude_code_bridge-zjc","type":"parent-child","created_at":"2026-01-30T02:01:14.976845-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-zjc.4","title":"Registry: stale detection (TTL, pid checks, self-heal)","description":"Add stale state detection and isolation tightening.\n\n## Files\n- lib/pane_registry.py\n- lib/claude_comm.py\n- state readers\n\n## Implementation\n- Add owner identity fields: created_at, last_seen_at, pid, instance token\n- Verify pid is alive on read (best-effort)\n- Check timestamps within TTL, project key matches normalized workdir\n- Provide --cleanup and self-heal paths\n\n## Acceptance Criteria\n- [ ] Stale sessions detected by TTL and pid checks\n- [ ] Invalid/stale state ignored and regenerated\n- [ ] Self-heal path for corrupted state\n- [ ] Tests for stale state scenarios","status":"open","priority":2,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:01:29.98364-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:01:29.98364-08:00","labels":["registry","robustness","state"],"dependencies":[{"issue_id":"claude_code_bridge-zjc.4","depends_on_id":"claude_code_bridge-zjc","type":"parent-child","created_at":"2026-01-30T02:01:29.984208-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-zjc.4","depends_on_id":"claude_code_bridge-zjc.2","type":"blocked-by","created_at":"2026-01-30T02:01:29.985189-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-zjc.5","title":"Errors: replace bare excepts; add debug diagnostics","description":"Systematically replace bare exception handlers with typed handling.\n\n## Scope\n~352 bare except handlers across ~42 files\n\n## Implementation\n- Triage into categories: file I/O, JSON parsing, subprocess, sockets\n- Replace with narrow exception types\n- When CCB_DEBUG=1, emit structured diagnostics to stderr/log\n- Make recovery behavior intentional and debuggable\n\n## Acceptance Criteria\n- [ ] No bare except: or except Exception: without justification\n- [ ] CCB_DEBUG=1 shows structured error info\n- [ ] Recovery behavior is explicit and documented\n- [ ] Tests for error recovery paths","status":"open","priority":2,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:01:30.174492-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:01:30.174492-08:00","labels":["errors","observability","refactor","robustness"],"dependencies":[{"issue_id":"claude_code_bridge-zjc.5","depends_on_id":"claude_code_bridge-zjc","type":"parent-child","created_at":"2026-01-30T02:01:30.175038-08:00","created_by":"stefanc-ai2"}]}
