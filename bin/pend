#!/usr/bin/env python3
"""
pend - View latest reply from AI providers.

Usage:
    pend <provider> [N] [--session-file FILE]

Providers:
    codex, claude

Arguments:
    N    Show the latest N conversations (default: 1)
"""

import sys
import os
import subprocess
from pathlib import Path

script_dir = Path(__file__).resolve().parent


# Provider to original pend command mapping
PROVIDER_PENDS = {
    "codex": "cpend",
    "claude": "lpend",
}


def _usage():
    print("Usage: pend <provider> [N] [--session-file FILE]", file=sys.stderr)
    print("", file=sys.stderr)
    print("Providers:", file=sys.stderr)
    print("  codex, claude", file=sys.stderr)
    print("", file=sys.stderr)
    print("Arguments:", file=sys.stderr)
    print("  N    Show the latest N conversations (default: 1)", file=sys.stderr)


def main():
    if len(sys.argv) < 2:
        _usage()
        return 1

    provider = sys.argv[1].lower()

    if provider in ("-h", "--help"):
        _usage()
        return 0

    if provider not in PROVIDER_PENDS:
        print(f"[ERROR] Unknown provider: {provider}", file=sys.stderr)
        print(f"[ERROR] Available: {', '.join(PROVIDER_PENDS.keys())}", file=sys.stderr)
        return 1

    # Get the original pend command
    pend_cmd = PROVIDER_PENDS[provider]
    pend_path = script_dir / pend_cmd

    if not pend_path.exists():
        print(f"[ERROR] Command not found: {pend_path}", file=sys.stderr)
        return 1

    # Pass remaining arguments to the original command
    # On Windows, need to use Python interpreter explicitly
    if sys.platform == "win32":
        cmd = [sys.executable, str(pend_path)] + sys.argv[2:]
    else:
        cmd = [str(pend_path)] + sys.argv[2:]

    try:
        result = subprocess.run(cmd)
        return result.returncode
    except Exception as e:
        print(f"[ERROR] {e}", file=sys.stderr)
        return 1


if __name__ == "__main__":
    sys.exit(main())
